<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PayFast - PPOB Modern</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
    /* --- RESET & VARIABLES --- */
    :root {
        --primary: #4F46E5;
        --primary-dark: #4338ca;
        --secondary: #EC4899;
        --bg-body: #F3F4F6;
        --bg-card: #ffffff;
        --text-main: #1F2937;
        --text-muted: #6B7280;
        --success: #10B981;
        --danger: #EF4444;
        --warning: #F59E0B;
        --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        --radius-lg: 16px;
        --app-width: 480px;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
    }

    html {
        height: 100%;
    }

    body {
        font-family: 'Inter', sans-serif;
        background-color: #e5e7eb;
        height: 100%;
        overflow: hidden;
        color: var(--text-main);
        display: flex;
        justify-content: center;
    }

    /* --- APP CONTAINER --- */
    .app-container {
        width: 100%;
        max-width: var(--app-width);
        background: var(--bg-card);
        height: 100%;
        position: relative;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* --- CONTENT AREA SCROLLABLE --- */
    .content-area {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 70px;
        position: relative;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
    }

    .content-area::-webkit-scrollbar {
        display: none;
    }

    /* --- VIEWS SYSTEM --- */
    .view-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-body);
        transition: transform 0.3s ease-in-out, opacity 0.3s ease;
        opacity: 0;
        pointer-events: none;
        transform: translateX(20px);
        z-index: 10;
        display: flex;
        flex-direction: column;
    }

    .view-section.active {
        opacity: 1;
        pointer-events: all;
        transform: translateX(0);
        z-index: 20;
    }

    /* --- HEADER --- */
    .header-section {
        margin-top: 20px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        padding: 25px 20px;
        margin-left: 10px;
        margin-right: 10px;
        border-bottom-left-radius: 30px;
        border-bottom-right-radius: 30px; 
        border-top-left-radius: 30px; 
        border-top-right-radius: 30px;
        color: white;
        position: relative;
        z-index: 5;
        flex-shrink: 0;
    }
    /* --- BACKGROUND LAYER DI BELAKANG HEADER --- */
    
    /* Kita tempel background ini ke content-area khusus di view-home */
    #view-home .content-area::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 75px;
        background: var(--primary-dark); 
        border-bottom-right-radius: 0px;
        border-bottom-left-radius: 0px;
        z-index: 0;
    }

    .user-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .user-info h2 {
        font-size: 1.1rem;
        font-weight: 600;
    }

    .user-info p {
        font-size: 0.85rem;
        opacity: 0.9;
    }

    .notif-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        position: relative;
    }

    .notif-dot {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 8px;
        height: 8px;
        background: var(--danger);
        border-radius: 50%;
        border: 1px solid white;
    }

    /* --- BALANCE CARD --- */
    .balance-card {
        margin-top: 1.5rem;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        /*border: 1px solid rgba(255, 255, 255, 0.2);*/
        border-bottom-left-radius: 20px;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        border-bottom-right-radius: 20px;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .balance-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .balance-label {
        font-size: 0.75rem;
        opacity: 0.85;
        font-weight: 400;
    }

    .balance-amount {
        font-size: 1.35rem;
        font-weight: 700;
        letter-spacing: -0.5px;
        transition: color 0.3s;
    }

    .balance-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn-mini {
        width: 42px;
        height: 42px;
        background: white;
        border: none;
        border-radius: 16px;
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.1s;
    }

    .action-btn-mini:active {
        transform: scale(0.92);
    }

    .action-btn-mini.secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        box-shadow: none;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    /* --- RUNNING TEXT / TICKER (Updated: Start from Right) --- */
    .ticker-section {
        background: #ffedd5;
        margin: 15px 20px 5px 20px;
        padding: 12px 15px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
        position: relative;
        overflow: hidden;
    }

    .ticker-icon {
        color: var(--warning);
        font-size: 1.1rem;
        flex-shrink: 0;
        z-index: 2; /* Supaya icon tetap di atas teks */
        animation: swing 2s ease-in-out infinite;
    }

    @keyframes swing {
        0%, 100% { transform: rotate(0deg); }
        20% { transform: rotate(15deg); }
        40% { transform: rotate(-10deg); }
        60% { transform: rotate(5deg); }
        80% { transform: rotate(-5deg); }
    }

    .ticker-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
        mask-image: linear-gradient(to right, transparent, black 2%, black 98%, transparent);
        -webkit-mask-image: linear-gradient(to right, transparent, black 2%, black 98%, transparent);
    }

    .ticker-content {
        display: inline-block;
        white-space: nowrap;
        font-size: 0.8rem;
        color: var(--text-main);
        font-weight: 500;
        /* Start animasi dari kanan luar */
        padding-left: 100%; 
        animation: marquee 20s linear infinite;
    }

    /* Animasi: Bergerak dari posisi awal (kanan) ke kiri sampai habis */
    @keyframes marquee {
        0% { transform: translate3d(0, 0, 0); }
        100% { transform: translate3d(-100%, 0, 0); }
    }

    /* --- MENU GRID --- */
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px 10px;
        padding: 25px 20px;
    }

    .menu-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }

    .icon-box {
        width: 50px;
        height: 50px;
        background: #F0F3FF;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: var(--primary);
        transition: all 0.2s;
        box-shadow: var(--shadow-soft);
    }

    .menu-item:active .icon-box {
        transform: scale(0.95);
    }

    .menu-item span {
        font-size: 0.75rem;
        font-weight: 500;
        color: var(--text-main);
        text-align: center;
    }

    .menu-item {
        position: relative;
        overflow: visible;
    }

    .badge-hot {
        position: absolute;
        top: -5px;
        right: 0px;
        background: #EF4444;
        color: white;
        font-size: 0.6rem;
        font-weight: 700;
        padding: 2px 6px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        z-index: 5;
        display: flex;
        align-items: center;
        gap: 3px;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
        40% {transform: translateY(-3px);}
        60% {transform: translateY(-1.5px);}
    }

    /* --- PROMO & HISTORY --- */
    .promo-section {
        padding: 0 20px;
        margin-bottom: 25px;
    }

    .section-title {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
    }

    .section-title a {
        color: var(--primary);
        text-decoration: none;
        font-size: 0.8rem;
    }

    .banner-scroll {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding-bottom: 10px;
        scrollbar-width: none;
    }

    .banner-card {
        min-width: 280px;
        height: 140px;
        background: linear-gradient(to right, #2c3e50, #3498db);
        border-radius: var(--radius-lg);
        padding: 20px;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        flex-shrink: 0;
        cursor: pointer;
    }

    .banner-card:nth-child(2) {
        background: linear-gradient(to right, #833ab4, #fd1d1d);
    }

    .history-section {
        padding: 20px;
        background: white;
        border-top-left-radius: 30px;
        border-top-right-radius: 30px;
        min-height: 200px;
    }

    .transaction-item {
        display: flex;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #F3F4F6;
    }

    .trans-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        background: #F9FAFB;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 1.2rem;
    }

    .trans-details {
        flex: 1;
    }

    .trans-details h4 {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .trans-details p {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .trans-amount {
        font-weight: 600;
        font-size: 0.95rem;
        text-align: right;
    }

    .trans-amount.expense {
        color: var(--text-main);
    }

    .trans-amount.income {
        color: var(--success);
    }

    /* --- BOTTOM NAV --- */
    .bottom-nav {
        position: absolute;
        bottom: 0;
        width: 100%;
        background: white;
        height: 70px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-top: 1px solid #F3F4F6;
        z-index: 100;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.7rem;
        font-weight: 500;
        width: 60px;
    }

    .nav-item i {
        font-size: 1.3rem;
        transition: color 0.3s;
    }

    .nav-item.active {
        color: var(--primary);
    }

    .nav-fab-wrapper {
        position: relative;
        top: -25px;
    }

    .nav-fab {
        width: 60px;
        height: 60px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
        transition: transform 0.2s;
        border: 4px solid var(--bg-card);
    }

    .nav-fab:active {
        transform: scale(0.9);
    }

    /* --- SUB-PAGE STYLES --- */
    .sub-header {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 50;
        flex-shrink: 0;
    }

    .back-btn {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: var(--text-main);
        cursor: pointer;
        padding: 5px;
    }

    .page-title {
        font-size: 1.1rem;
        font-weight: 700;
    }

    .form-container {
        padding: 20px;
    }

    .input-group {
        margin-bottom: 20px;
        position: relative;
    }

    .input-label {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-main);
    }

    .input-field {
        width: 100%;
        padding: 14px 15px;
        border: 1px solid #E5E7EB;
        border-radius: 12px;
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
        background: #F9FAFB;
    }

    .input-field:focus {
        border-color: var(--primary);
        background: white;
    }

    .hint-text {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 5px;
        display: flex;
        justify-content: space-between;
    }

    .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 10px;
    }

    .product-card {
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
    }

    .product-card:hover {
        border-color: var(--primary);
    }

    .product-card.selected {
        border-color: var(--primary);
        background: #EEF2FF;
        box-shadow: 0 0 0 1px var(--primary);
    }

    .product-card.selected::after {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        top: 5px;
        right: 8px;
        color: var(--primary);
        font-size: 0.8rem;
    }

    .p-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-main);
        display: block;
        margin-bottom: 4px;
    }

    .p-price {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .p-price span {
        color: var(--primary);
        font-weight: 700;
    }

    .action-btn {
        width: 100%;
        padding: 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        transition: background 0.3s;
        margin-bottom: 90px;
    }

    .action-btn:disabled {
        background: #CBD5E1;
        cursor: not-allowed;
        box-shadow: none;
    }

    /* --- TOP UP SPECIFIC STYLES --- */
    .nominal-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 10px;
    }

    .nominal-chip {
        padding: 10px;
        border: 1px solid #E5E7EB;
        border-radius: 10px;
        background: white;
        text-align: center;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .nominal-chip.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    /* Accordion Style */
    .method-accordion {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
    }

    .accordion-item {
        border: 1px solid #E5E7EB;
        border-radius: 12px;
        background: white;
        overflow: hidden;
        transition: border-color 0.2s;
    }

    .accordion-header {
        padding: 15px;
        display: flex;
        align-items: center;
        cursor: pointer;
        background: white;
        transition: background 0.2s;
    }

    .accordion-header:hover {
        background: #F9FAFB;
    }

    .accordion-header.active {
        background: #F9FAFB;
        border-bottom: 1px solid #E5E7EB;
    }

    .accordion-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: #F3F4F6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: var(--text-main);
        margin-right: 15px;
    }

    .accordion-info {
        flex: 1;
    }

    .accordion-info h4 {
        font-size: 0.9rem;
        font-weight: 600;
    }

    .accordion-info p {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .chevron-icon {
        font-size: 0.8rem;
        color: var(--text-muted);
        transition: transform 0.3s;
    }

    .accordion-header.active .chevron-icon {
        transform: rotate(180deg);
    }

    .accordion-body {
        display: none;
        background: #F9FAFB;
        padding: 10px;
    }

    .accordion-body.show {
        display: block;
        animation: slideDown 0.2s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .sub-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 8px;
        background: white;
        border: 1px solid #E5E7EB;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .sub-option:last-child {
        margin-bottom: 0;
    }

    .sub-option:hover {
        border-color: #d1d5db;
    }

    .sub-option.selected {
        border-color: var(--primary);
        background: #EEF2FF;
    }

    .sub-name {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-main);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .check-circle {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid #D1D5DB;
        position: relative;
    }

    .sub-option.selected .check-circle {
        border-color: var(--primary);
        background: var(--primary);
    }

    .sub-option.selected .check-circle::after {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 10px;
    }

    /* --- TOAST NOTIFICATION --- */
    .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-100px);
        background: #333;
        color: white;
        padding: 12px 24px;
        border-radius: 50px;
        font-size: 0.9rem;
        z-index: 999;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        width: max-content;
        max-width: 90%;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
    }

    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }

    /* --- GAMES VIEW SPECIFIC STYLES --- */
    .games-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        padding: 20px;
    }

    .game-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-soft);
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
        display: flex;
        flex-direction: column;
    }

    .game-card.active {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .game-img {
        width: 100%;
        aspect-ratio: 1/1;
        object-fit: cover;
        background: #e5e7eb;
    }

    .game-info {
        padding: 8px;
        text-align: center;
    }

    .game-title {
        font-size: 0.75rem;
        font-weight: 600;
        line-height: 1.2;
        color: var(--text-main);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Game Form Container (Initially Hidden) */
    #game-form-container {
        display: none;
        padding: 0 20px 20px 20px;
        animation: fadeInUp 0.3s ease-out;
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .input-row {
        display: flex;
        gap: 10px;
    }

    /* Utility colors */
    .icon-pln { color: #F59E0B; background: #FFFBEB; }
    .icon-pulsa { color: #EF4444; background: #FEF2F2; }
    .icon-data { color: #3B82F6; background: #EFF6FF; }
    .icon-game { color: #8B5CF6; background: #F5F3FF; }
    .icon-bpjs { color: #10B981; background: #ECFDF5; }
    .icon-pdam { color: #06B6D4; background: #ECFEFF; }

</style>
</head>
<body>

    <div class="app-container">
        
        <div id="toast" class="toast">
            <i class="fa-solid fa-circle-check"></i>
            <span id="toast-msg">Pesan disini</span>
        </div>

        <!-- VIEW HOME -->
        <div id="view-home" class="view-section active">
            <div class="content-area">
                <header class="header-section">
                    <div class="user-nav">
                        <div class="user-info">
                            <p>Selamat Pagi,</p>
                            <h2 id="user-name">Rizky Developer</h2>
                        </div>
                        <button class="notif-btn">
                            <i class="fa-regular fa-bell"></i>
                            <div class="notif-dot"></div>
                        </button>
                    </div>

                    <div class="balance-card">
                        <div class="balance-info">
                            <div class="balance-label">Saldo Akun</div>
                            <div class="balance-amount" id="main-balance">Rp 2.450.500</div>
                        </div>
                        
                        <div class="balance-actions">
                            <button class="action-btn-mini secondary" onclick="showToast('Menu Transfer', 'info')">
                                <i class="fa-solid fa-paper-plane"></i>
                            </button>
                            <button class="action-btn-mini" onclick="openTopUpPage()">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </header>

                <div class="ticker-section">
                    <div class="ticker-icon">
                        <i class="fa-solid fa-bell"></i>
                    </div>
                    <div class="ticker-wrapper">
                        <div class="ticker-content">
                            Selamat Datang di PayFast! • Promo Top Up Game Cashback 50% Hari Ini! • Server Pulsa & Data Stabil 24 Jam • Jangan Lupa Bayar Tagihan Listrik Tepat Waktu • Update Aplikasi Versi Terbaru Tersedia
                        </div>
                    </div>
                </div>

                <nav class="menu-grid">
                    <div class="menu-item" onclick="openService('pulsa')">
                        <div class="badge-hot"><i class="fa-solid fa-fire"></i> HOT</div>
                           <div class="icon-box icon-pulsa"><i class="fa-solid fa-mobile-screen"></i></div> 
                        <span>Pulsa</span>
                    </div>

                    <div class="menu-item" onclick="openService('data')">
                        <div class="icon-box icon-data"><i class="fa-solid fa-wifi"></i></div>
                        <span>Data</span>
                    </div>
                    <div class="menu-item" onclick="openService('pln')">
                        <div class="icon-box icon-pln"><i class="fa-solid fa-bolt"></i></div>
                        <span>PLN</span>
                    </div>
                    <div class="menu-item" onclick="openService('pdam')">
                        <div class="icon-box icon-pdam"><i class="fa-solid fa-faucet-drip"></i></div>
                        <span>PDAM</span>
                    </div>
                    <div class="menu-item" onclick="openService('game')">
                        <div class="badge-hot"><i class="fa-solid fa-fire"></i> HOT</div>
                        <div class="icon-box icon-game"><i class="fa-solid fa-gamepad"></i></div>
                        <span>Games</span>
                    </div>
                    <div class="menu-item" onclick="openService('bpjs')">
                        <div class="icon-box icon-bpjs"><i class="fa-solid fa-heart-pulse"></i></div>
                        <span>BPJS</span>
                    </div>
                    <div class="menu-item" onclick="showToast('Fitur e-money segera hadir!', 'info')">
                        <div class="icon-box"><i class="fa-solid fa-wallet"></i></div>
                        <span>E-Money</span>
                    </div>
                    
                    <div class="menu-item" id="btn-lainnya" onclick="expandMoreMenu()">
                        <div class="icon-box"><i class="fa-solid fa-ellipsis"></i></div>
                        <span>Lainnya</span>
                    </div>

                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Internet segera hadir!', 'info')">
                        <div class="icon-box" style="color: #EF4444; background: #FEF2F2;"><i class="fa-solid fa-rss"></i></div>
                        <span>Internet</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur TV Kabel segera hadir!', 'info')">
                        <div class="icon-box" style="color: #F59E0B; background: #FFFBEB;"><i class="fa-solid fa-tv"></i></div>
                        <span>TV Kabel</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Multifinance segera hadir!', 'info')">
                        <div class="icon-box" style="color: #10B981; background: #ECFDF5;"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                        <span>Cicilan</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Pajak PBB segera hadir!', 'info')">
                        <div class="icon-box" style="color: #6366f1; background: #e0e7ff;"><i class="fa-solid fa-building-columns"></i></div>
                        <span>Pajak PBB</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Gas PGN segera hadir!', 'info')">
                        <div class="icon-box" style="color: #3b82f6; background: #dbeafe;"><i class="fa-solid fa-fire-flame-simple"></i></div>
                        <span>Gas PGN</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Tiket KAI segera hadir!', 'info')">
                        <div class="icon-box" style="color: #f97316; background: #ffedd5;"><i class="fa-solid fa-train"></i></div>
                        <span>Kereta</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Tiket Pesawat segera hadir!', 'info')">
                        <div class="icon-box" style="color: #0ea5e9; background: #e0f2fe;"><i class="fa-solid fa-plane"></i></div>
                        <span>Pesawat</span>
                    </div>
                    <div class="menu-item menu-item-hidden" style="display: none;" onclick="showToast('Fitur Zakat segera hadir!', 'info')">
                        <div class="icon-box" style="color: #16a34a; background: #dcfce7;"><i class="fa-solid fa-hand-holding-heart"></i></div>
                        <span>Zakat</span>
                    </div>

                    <div class="menu-item" id="btn-tutup" style="display: none;" onclick="collapseMoreMenu()">
                        <div class="icon-box"><i class="fa-solid fa-chevron-up"></i></div>
                        <span>Tutup</span>
                    </div>

                </nav>

                <section class="promo-section">
                    <div class="section-title">
                        Promo Spesial
                    </div>
                    <div class="banner-scroll">
                        <div class="banner-card" onclick="openService('pulsa')">
                            <div class="banner-tag">Diskon 50%</div>
                            <div class="banner-text">
                                <h3>Flash Sale Pulsa</h3>
                                <p>Berlaku hingga besok!</p>
                            </div>
                        </div>
                        <div class="banner-card" onclick="openService('pln')">
                            <div class="banner-tag">Cashback</div>
                            <div class="banner-text">
                                <h3>Bayar Tagihan PLN</h3>
                                <p>Dapatkan koin rewards.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="history-section">
                    <div class="section-title">
                        Transaksi Terakhir
                    </div>
                    <div class="transaction-list" id="transaction-list">
                        <div class="transaction-item">
                            <div class="trans-icon" style="color: var(--primary);">
                                <i class="fa-solid fa-bolt"></i>
                            </div>
                            <div class="trans-details">
                                <h4>Token Listrik 100rb</h4>
                                <p>Hari ini, 10:30</p>
                            </div>
                            <div class="trans-amount expense">- Rp 102.500</div>
                        </div>
                        <div class="transaction-item">
                            <div class="trans-icon" style="color: var(--success);">
                                <i class="fa-solid fa-arrow-down"></i>
                            </div>
                            <div class="trans-details">
                                <h4>Top Up Saldo</h4>
                                <p>Kemarin, 15:45</p>
                            </div>
                            <div class="trans-amount income">+ Rp 500.000</div>
                        </div>
                         <div class="transaction-item">
                            <div class="trans-icon" style="color: var(--secondary);">
                                <i class="fa-solid fa-mobile-screen"></i>
                            </div>
                            <div class="trans-details">
                                <h4>Telkomsel Data 20GB</h4>
                                <p>12 Jan 2023</p>
                            </div>
                            <div class="trans-amount expense">- Rp 98.000</div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- VIEW PULSA -->
        <div id="view-pulsa" class="view-section">
            <div class="sub-header">
                <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                <div class="page-title">Isi Pulsa</div>
            </div>
            <div class="content-area form-container">
                <div class="input-group">
                    <label class="input-label">Nomor Handphone</label>
                    <input type="tel" id="pulsa-number" class="input-field" placeholder="08xx-xxxx-xxxx" onkeyup="checkProvider(); validatePulsaForm()">
                    <div class="hint-text">
                        <span id="provider-detected"></span>
                        <span>Simpan nomor</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Pilih Nominal</label>
                    <div class="product-grid" id="pulsa-grid">
                        </div>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label class="input-label">Metode Pembayaran</label>
                    <div class="method-accordion">
                        
                        <div class="sub-option" id="opt-saldo" onclick="selectPulsaMethod('Saldo Akun', 'Saldo', this)" style="border: 1px solid #E5E7EB; margin-bottom: 10px;">
                            <div class="sub-name"><i class="fa-solid fa-wallet" style="color:var(--primary)"></i> Saldo Akun</div>
                            <div class="check-circle"></div>
                        </div>

                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('pulsa-bank-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-building-columns"></i></div>
                                <div class="accordion-info">
                                    <h4>Transfer Bank</h4>
                                    <p>Virtual Account</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="pulsa-bank-content" class="accordion-body">
                                <div class="sub-option" onclick="selectPulsaMethod('Transfer Bank', 'BCA', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BCA</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('Transfer Bank', 'BRI', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BRI</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('Transfer Bank', 'Mandiri', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Mandiri</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('Transfer Bank', 'BNI', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BNI</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('pulsa-ewallet-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-qrcode"></i></div>
                                <div class="accordion-info">
                                    <h4>QRIS / E-Wallet</h4>
                                    <p>GoPay, OVO, Dana, ShopeePay</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="pulsa-ewallet-content" class="accordion-body">
                                <div class="sub-option" onclick="selectPulsaMethod('QRIS', 'QRIS Universal', this)">
                                    <div class="sub-name"><i class="fa-solid fa-qrcode"></i> QRIS (Semua E-Wallet)</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('E-Wallet', 'OVO', this)">
                                    <div class="sub-name">OVO</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('E-Wallet', 'DANA', this)">
                                    <div class="sub-name">DANA</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('E-Wallet', 'ShopeePay', this)">
                                    <div class="sub-name">ShopeePay</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('pulsa-retail-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-store"></i></div>
                                <div class="accordion-info">
                                    <h4>Minimarket</h4>
                                    <p>Alfamart / Indomaret</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="pulsa-retail-content" class="accordion-body">
                                <div class="sub-option" onclick="selectPulsaMethod('Minimarket', 'Alfamart', this)">
                                    <div class="sub-name"><i class="fa-solid fa-store"></i> Alfamart</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectPulsaMethod('Minimarket', 'Indomaret', this)">
                                    <div class="sub-name"><i class="fa-solid fa-store"></i> Indomaret</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <button id="btn-bayar-pulsa" class="action-btn" disabled onclick="processPulsaTransaction()">Pilih Nominal & Metode</button>
            </div>
        </div>

        <!-- VIEW GAMES -->
        <div id="view-games" class="view-section">
            <div class="sub-header">
                <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                <div class="page-title">Voucher Game</div>
            </div>
            <div class="content-area">
                <!-- 1. List Game Grid -->
                <div class="games-grid" id="games-list-container">
                    <!-- Rendered by JS -->
                </div>

                <!-- 2. Form Produk (Muncul setelah pilih game) -->
                <div id="game-form-container">
                    
                    <div style="background: #EEF2FF; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fa-solid fa-gamepad" style="color: var(--primary);"></i>
                        <span style="font-size: 0.85rem; color: var(--primary-dark); font-weight: 500;">Dipilih: <b id="selected-game-name">Game Name</b></span>
                    </div>

                    <div class="input-group">
                        <label class="input-label">User ID</label>
                        <div class="input-row">
                            <input type="number" id="game-userid" class="input-field" placeholder="Masukkan User ID" onkeyup="validateGamesForm()">
                            <input type="number" id="game-zoneid" class="input-field" placeholder="Zone ID (Opsional)" style="width: 40%;" onkeyup="validateGamesForm()">
                        </div>
                        <div class="hint-text">
                            <span id="game-nickname"></span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Pilih Nominal</label>
                        <div class="product-grid" id="games-product-grid">
                            <!-- Products rendered here -->
                        </div>
                    </div>

                    <div class="input-group" style="margin-top: 20px;">
                        <label class="input-label">Metode Pembayaran</label>
                        <div class="method-accordion">
                            
                            <div class="sub-option" id="opt-game-saldo" onclick="selectGamesMethod('Saldo Akun', 'Saldo', this)" style="border: 1px solid #E5E7EB; margin-bottom: 10px;">
                                <div class="sub-name"><i class="fa-solid fa-wallet" style="color:var(--primary)"></i> Saldo Akun</div>
                                <div class="check-circle"></div>
                            </div>

                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion('game-bank-content', this)">
                                    <div class="accordion-icon"><i class="fa-solid fa-building-columns"></i></div>
                                    <div class="accordion-info">
                                        <h4>Transfer Bank</h4>
                                        <p>Virtual Account</p>
                                    </div>
                                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                                </div>
                                <div id="game-bank-content" class="accordion-body">
                                    <div class="sub-option" onclick="selectGamesMethod('Transfer Bank', 'BCA', this)">
                                        <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BCA</div>
                                        <div class="check-circle"></div>
                                    </div>
                                    <div class="sub-option" onclick="selectGamesMethod('Transfer Bank', 'BRI', this)">
                                        <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BRI</div>
                                        <div class="check-circle"></div>
                                    </div>
                                    <div class="sub-option" onclick="selectGamesMethod('Transfer Bank', 'Mandiri', this)">
                                        <div class="sub-name"><i class="fa-solid fa-bank"></i> Mandiri</div>
                                        <div class="check-circle"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion('game-ewallet-content', this)">
                                    <div class="accordion-icon"><i class="fa-solid fa-qrcode"></i></div>
                                    <div class="accordion-info">
                                        <h4>QRIS / E-Wallet</h4>
                                        <p>GoPay, OVO, Dana, ShopeePay</p>
                                    </div>
                                    <i class="fa-solid fa-chevron-down chevron-icon"></i>
                                </div>
                                <div id="game-ewallet-content" class="accordion-body">
                                    <div class="sub-option" onclick="selectGamesMethod('QRIS', 'QRIS Universal', this)">
                                        <div class="sub-name"><i class="fa-solid fa-qrcode"></i> QRIS (Semua E-Wallet)</div>
                                        <div class="check-circle"></div>
                                    </div>
                                    <div class="sub-option" onclick="selectGamesMethod('E-Wallet', 'OVO', this)">
                                        <div class="sub-name">OVO</div>
                                        <div class="check-circle"></div>
                                    </div>
                                    <div class="sub-option" onclick="selectGamesMethod('E-Wallet', 'DANA', this)">
                                        <div class="sub-name">DANA</div>
                                        <div class="check-circle"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <button id="btn-bayar-game" class="action-btn" disabled onclick="processGamesTransaction()">Pilih Nominal & Metode</button>
                </div>
            </div>
        </div>

        <div id="view-pln" class="view-section">
            <div class="sub-header">
                <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                <div class="page-title">Token Listrik PLN</div>
            </div>
            <div class="content-area form-container">
                <div class="input-group">
                    <label class="input-label">ID Pelanggan / No. Meter</label>
                    <input type="number" id="pln-id" class="input-field" placeholder="Contoh: 12345678901">
                    <div class="hint-text">
                        <span id="pln-name" style="color: var(--primary); font-weight: 500;"></span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Nominal Token</label>
                    <div class="product-grid" id="pln-grid">
                        </div>
                </div>

                <button id="btn-beli-pln" class="action-btn" disabled onclick="processTransaction('PLN Token')">Beli Token</button>
            </div>
        </div>

        <div id="view-generic" class="view-section">
            <div class="sub-header">
                <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                <div class="page-title" id="generic-title">Layanan</div>
            </div>
            <div class="content-area form-container" style="text-align: center; padding-top: 50px;">
                <div class="icon-box" style="width: 80px; height: 80px; margin: 0 auto 20px; font-size: 2rem;">
                    <i class="fa-solid fa-person-digging"></i>
                </div>
                <h3 style="margin-bottom: 10px;">Dalam Pengembangan</h3>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Layanan ini sedang diperbarui sistemnya.</p>
            </div>
        </div>

        <div id="view-topup" class="view-section">
            <div class="sub-header">
                <button class="back-btn" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                <div class="page-title">Isi Saldo</div>
            </div>
            <div class="content-area form-container">
                <div class="input-group">
                    <label class="input-label">Masukkan Nominal (Rp)</label>
                    <input type="number" id="topup-amount-input" class="input-field" placeholder="Minimal Rp 10.000" onkeyup="handleTopUpInput(this.value)">
                    <div class="nominal-grid">
                        <div class="nominal-chip" onclick="selectTopUpAmount(20000)">20.000</div>
                        <div class="nominal-chip" onclick="selectTopUpAmount(50000)">50.000</div>
                        <div class="nominal-chip" onclick="selectTopUpAmount(100000)">100.000</div>
                        <div class="nominal-chip" onclick="selectTopUpAmount(200000)">200.000</div>
                        <div class="nominal-chip" onclick="selectTopUpAmount(500000)">500.000</div>
                        <div class="nominal-chip" onclick="selectTopUpAmount(1000000)">1.000.000</div>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 30px;">
                    <label class="input-label">Metode Pembayaran</label>
                    <div class="method-accordion">
                        
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('bank-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-building-columns"></i></div>
                                <div class="accordion-info">
                                    <h4>Transfer Bank</h4>
                                    <p>Otomatis verifikasi</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="bank-content" class="accordion-body">
                                <div class="sub-option" onclick="selectSubMethod('Transfer Bank', 'BCA', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BCA</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('Transfer Bank', 'BRI', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BRI</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('Transfer Bank', 'Mandiri', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Mandiri</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('Transfer Bank', 'BNI', this)">
                                    <div class="sub-name"><i class="fa-solid fa-bank"></i> Bank BNI</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('ewallet-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-qrcode"></i></div>
                                <div class="accordion-info">
                                    <h4>QRIS / E-Wallet</h4>
                                    <p>GoPay, OVO, Dana, ShopeePay</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="ewallet-content" class="accordion-body">
                                <div class="sub-option" onclick="selectSubMethod('QRIS', 'QRIS Universal', this)">
                                    <div class="sub-name"><i class="fa-solid fa-qrcode"></i> QRIS (Semua E-Wallet)</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('E-Wallet', 'OVO', this)">
                                    <div class="sub-name">OVO</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('E-Wallet', 'DANA', this)">
                                    <div class="sub-name">DANA</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('E-Wallet', 'ShopeePay', this)">
                                    <div class="sub-name">ShopeePay</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <div class="accordion-header" onclick="toggleAccordion('retail-content', this)">
                                <div class="accordion-icon"><i class="fa-solid fa-store"></i></div>
                                <div class="accordion-info">
                                    <h4>Minimarket</h4>
                                    <p>Alfamart / Indomaret</p>
                                </div>
                                <i class="fa-solid fa-chevron-down chevron-icon"></i>
                            </div>
                            <div id="retail-content" class="accordion-body">
                                <div class="sub-option" onclick="selectSubMethod('Minimarket', 'Alfamart', this)">
                                    <div class="sub-name"><i class="fa-solid fa-store"></i> Alfamart</div>
                                    <div class="check-circle"></div>
                                </div>
                                <div class="sub-option" onclick="selectSubMethod('Minimarket', 'Indomaret', this)">
                                    <div class="sub-name"><i class="fa-solid fa-store"></i> Indomaret</div>
                                    <div class="check-circle"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <button id="btn-process-topup" class="action-btn" disabled onclick="processTopUpNew()">Konfirmasi Pembayaran</button>
            </div>
        </div>

        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="switchTab('home', this)">
                <i class="fa-solid fa-house"></i>
                Home
            </a>
            <a href="#" class="nav-item" onclick="switchTab('history', this)">
                <i class="fa-solid fa-clock-rotate-left"></i>
                Riwayat
            </a>
            
            <div class="nav-fab-wrapper">
                <div class="nav-fab" onclick="openTopUpPage()">
                    <i class="fa-solid fa-plus"></i>
                </div>
            </div>

            <a href="#" class="nav-item" onclick="showToast('Inbox kosong', 'info')">
                <i class="fa-solid fa-inbox"></i>
                Inbox
            </a>
            <a href="#" class="nav-item" onclick="showToast('Halaman Akun', 'info')">
                <i class="fa-regular fa-user"></i>
                Akun
            </a>
        </div>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let currentBalance = 2450500;
        let selectedProduct = null;
        let historyCount = 0;
        
        // State for Top Up
        let topUpAmount = 0;
        let topUpCategory = null; // e.g., Bank Transfer
        let topUpProvider = null; // e.g., BCA

        // State Baru untuk Transaksi Pulsa
        let selectedPulsaMethod = null;   // 'Saldo', 'Bank', 'E-Wallet'
        let selectedPulsaProvider = null; // 'BCA', 'DANA', dll

        // --- STATE BARU UNTUK GAMES ---
        let selectedGameId = null;
        let selectedGameProduct = null;
        let selectedGamesMethod = null;
        let selectedGamesProvider = null;

        const gamesCatalog = [
            {
                id: 'mlbb',
                name: 'Mobile Legends',
                img: 'https://picsum.photos/seed/mlbb/200/200', 
                items: [
                    { name: '86 Diamonds', price: 23000 },
                    { name: '172 Diamonds', price: 46000 },
                    { name: '257 Diamonds', price: 68000 },
                    { name: '706 Diamonds', price: 185000 },
                    { name: 'Weekly Pass', price: 28000 },
                    { name: 'Twilight Pass', price: 150000 }
                ]
            },
            {
                id: 'ff',
                name: 'Free Fire',
                img: 'https://picsum.photos/seed/ff/200/200',
                items: [
                    { name: '70 Diamonds', price: 10000 },
                    { name: '140 Diamonds', price: 20000 },
                    { name: '355 Diamonds', price: 50000 },
                    { name: '720 Diamonds', price: 100000 },
                    { name: 'Member Mingguan', price: 30000 },
                    { name: 'Member Bulanan', price: 150000 }
                ]
            },
            {
                id: 'pubgm',
                name: 'PUBG Mobile',
                img: 'https://picsum.photos/seed/pubg/200/200',
                items: [
                    { name: '60 UC', price: 15000 },
                    { name: '325 UC', price: 75000 },
                    { name: '660 UC', price: 150000 },
                    { name: '1800 UC', price: 350000 },
                    { name: 'Royal Pass', price: 160000 },
                    { name: 'UC Pack', price: 50000 }
                ]
            },
            {
                id: 'gi',
                name: 'Genshin Impact',
                img: 'https://picsum.photos/seed/genshin/200/200',
                items: [
                    { name: '60 Genesis', price: 16000 },
                    { name: '300 Genesis', price: 79000 },
                    { name: '980 Genesis', price: 249000 },
                    { name: 'Welkin Moon', price: 79000 },
                    { name: 'Gnostic Hymn', price: 159000 }
                ]
            },
            {
                id: 'val',
                name: 'Valorant',
                img: 'https://picsum.photos/seed/valorant/200/200',
                items: [
                    { name: '125 VP', price: 15000 },
                    { name: '420 VP', price: 50000 },
                    { name: '700 VP', price: 80000 },
                    { name: '1375 VP', price: 150000 },
                    { name: '2400 VP', price: 250000 }
                ]
            },
            {
                id: 'hok',
                name: 'Honor of Kings',
                img: 'https://picsum.photos/seed/hok/200/200',
                items: [
                    { name: '16 Tokens', price: 3000 },
                    { name: '80 Tokens', price: 15000 },
                    { name: '240 Tokens', price: 45000 },
                    { name: '800 Tokens', price: 150000 }
                ]
            }
        ];

        // --- NAVIGATION LOGIC ---
        function navigateTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
            });
            const target = document.getElementById(viewId);
            if(target) {
                target.classList.add('active');
            }
        }

        function goBack() {
            navigateTo('view-home');
        }

        function switchTab(tabName, el) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if(el) el.classList.add('active');
            
            if(tabName === 'home') {
                navigateTo('view-home');
            } else {
                showToast('Halaman ' + tabName + ' belum tersedia', 'info');
            }
        }

        // --- LOGIKA MENU LAINNYA ---
        function expandMoreMenu() {
            document.getElementById('btn-lainnya').style.display = 'none';
            const hiddenItems = document.querySelectorAll('.menu-item-hidden');
            hiddenItems.forEach(item => {
                item.style.display = 'flex';
                item.style.opacity = '0';
                setTimeout(() => {
                    item.style.transition = 'opacity 0.3s';
                    item.style.opacity = '1';
                }, 10);
            });
            document.getElementById('btn-tutup').style.display = 'flex';
        }

        function collapseMoreMenu() {
            document.getElementById('btn-tutup').style.display = 'none';
            const hiddenItems = document.querySelectorAll('.menu-item-hidden');
            hiddenItems.forEach(item => {
                item.style.display = 'none';
            });
            document.getElementById('btn-lainnya').style.display = 'flex';
        }

        // --- GAMES LOGIC ---
        function openGamesView() {
            // Reset State Games
            selectedGameId = null;
            selectedGameProduct = null;
            selectedGamesMethod = null;
            selectedGamesProvider = null;

            document.getElementById('games-list-container').style.display = 'grid';
            document.getElementById('game-form-container').style.display = 'none';
            document.getElementById('game-userid').value = '';
            document.getElementById('game-zoneid').value = '';
            document.getElementById('game-nickname').innerText = '';

            // Reset UI Accordion
            document.querySelectorAll('#view-games .accordion-body').forEach(b => b.classList.remove('show'));
            document.querySelectorAll('#view-games .accordion-header').forEach(h => h.classList.remove('active'));
            document.querySelectorAll('#view-games .sub-option').forEach(o => o.classList.remove('selected'));

            // Render Games List
            const container = document.getElementById('games-list-container');
            container.innerHTML = '';
            gamesCatalog.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.onclick = () => selectGame(game.id, card);
                card.innerHTML = `
                    <img src="${game.img}" class="game-img" alt="${game.name}">
                    <div class="game-info">
                        <div class="game-title">${game.name}</div>
                    </div>
                `;
                container.appendChild(card);
            });

            navigateTo('view-games');
        }

        function selectGame(gameId, cardEl) {
            // Visual feedback
            document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active'));
            cardEl.classList.add('active');

            // Set data
            selectedGameId = gameId;
            const gameData = gamesCatalog.find(g => g.id === gameId);
            
            // Show form
            document.getElementById('selected-game-name').innerText = gameData.name;
            const formContainer = document.getElementById('game-form-container');
            formContainer.style.display = 'block';
            
            // Scroll to form
            setTimeout(() => {
                formContainer.scrollIntoView({ behavior: 'smooth' });
            }, 100);

            // Render Products
            const productGrid = document.getElementById('games-product-grid');
            productGrid.innerHTML = '';
            gameData.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'product-card';
                div.onclick = () => selectGamesProduct(div, item.price);
                div.innerHTML = `
                    <span class="p-name">${item.name}</span>
                    <span class="p-price">Rp <span>${item.price.toLocaleString('id-ID')}</span></span>
                `;
                productGrid.appendChild(div);
            });
        }

        function selectGamesProduct(el, price) {
            const parent = el.parentElement;
            Array.from(parent.children).forEach(child => child.classList.remove('selected'));
            el.classList.add('selected');
            selectedGameProduct = price;
            validateGamesForm();
        }

        function selectGamesMethod(category, provider, el) {
            const container = document.querySelector('#view-games');
            container.querySelectorAll('.sub-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            
            selectedGamesMethod = category;
            selectedGamesProvider = provider;
            
            validateGamesForm();
        }

        function validateGamesForm() {
            const btn = document.getElementById('btn-bayar-game');
            const userId = document.getElementById('game-userid').value;
            
            if (selectedGameProduct && userId.length > 3 && selectedGamesProvider) {
                btn.disabled = false;
                btn.innerHTML = `Bayar <b>Rp ${formatRupiah(selectedGameProduct)}</b> via ${selectedGamesProvider}`;
            } else {
                btn.disabled = true;
                btn.innerText = "Pilih Nominal & Metode";
            }
        }

        function processGamesTransaction() {
            const btn = document.getElementById('btn-bayar-game');
            const userId = document.getElementById('game-userid').value;
            const gameData = gamesCatalog.find(g => g.id === selectedGameId);

            // 1. Cek Saldo jika pakai Saldo
            if (selectedGamesProvider === 'Saldo') {
                if (currentBalance < selectedGameProduct) {
                    showToast("Saldo akun tidak mencukupi!", "error");
                    return;
                }
            }

            // 2. Loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Memproses...';

            // 3. Simulasi Proses
            setTimeout(() => {
                if (selectedGamesProvider === 'Saldo') {
                    updateBalance(selectedGameProduct, 'expense');
                }
                
                addHistory(`${gameData.name} (${userId}) via ${selectedGamesProvider}`, selectedGameProduct, 'expense');
                showToast("Voucher Game Berhasil Dikirim!", "success");

                setTimeout(() => {
                    goBack();
                }, 1000);
            }, 2000);
        }


        // --- TOP UP LOGIC ---
        function openTopUpPage() {
            document.getElementById('topup-amount-input').value = '';
            document.querySelectorAll('.nominal-chip').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.accordion-body').forEach(b => b.classList.remove('show'));
            document.querySelectorAll('.accordion-header').forEach(h => h.classList.remove('active'));
            document.querySelectorAll('.sub-option').forEach(o => o.classList.remove('selected'));
            
            document.getElementById('btn-process-topup').disabled = true;
            document.getElementById('btn-process-topup').innerText = "Konfirmasi Pembayaran";
            
            topUpAmount = 0;
            topUpCategory = null;
            topUpProvider = null;
            
            navigateTo('view-topup');
        }

        function handleTopUpInput(val) {
            topUpAmount = parseInt(val);
            if(isNaN(topUpAmount)) topUpAmount = 0;
            document.querySelectorAll('.nominal-chip').forEach(chip => {
                chip.classList.remove('active');
                let chipVal = parseInt(chip.innerText.replace(/\./g, ''));
                if(chipVal === topUpAmount) {
                    chip.classList.add('active');
                }
            });
            validateTopUp();
        }

        function selectTopUpAmount(amount) {
            topUpAmount = amount;
            document.getElementById('topup-amount-input').value = amount;
            document.querySelectorAll('.nominal-chip').forEach(chip => {
                chip.classList.remove('active');
                let chipVal = parseInt(chip.innerText.replace(/\./g, ''));
                if(chipVal === amount) chip.classList.add('active');
            });
            validateTopUp();
        }

        function toggleAccordion(contentId, headerEl) {
            const isClosed = !headerEl.classList.contains('active');
            const parent = headerEl.closest('.method-accordion');
            if(parent) {
                parent.querySelectorAll('.accordion-body').forEach(b => b.classList.remove('show'));
                parent.querySelectorAll('.accordion-header').forEach(h => h.classList.remove('active'));
            }
            if(isClosed) {
                document.getElementById(contentId).classList.add('show');
                headerEl.classList.add('active');
            }
        }

        function selectSubMethod(category, provider, el) {
            const parent = el.closest('.method-accordion');
            parent.querySelectorAll('.sub-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            topUpCategory = category;
            topUpProvider = provider;
            validateTopUp();
        }

        function validateTopUp() {
            const btn = document.getElementById('btn-process-topup');
            if(topUpAmount >= 10000 && topUpProvider) {
                btn.disabled = false;
                btn.innerText = "Bayar Rp " + formatRupiah(topUpAmount);
            } else {
                btn.disabled = true;
                btn.innerText = "Konfirmasi Pembayaran";
            }
        }

        function processTopUpNew() {
            const btn = document.getElementById('btn-process-topup');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Memproses...';
            
            setTimeout(() => {
                updateBalance(topUpAmount, 'income');
                addHistory('Top Up via ' + topUpProvider, topUpAmount, 'income');
                showToast('Top Up Berhasil!', 'success');
                
                btn.innerHTML = 'Berhasil!';
                setTimeout(() => {
                    goBack();
                }, 1000);
            }, 1500);
        }

        // --- SERVICE LOGIC (Pulsa & Data) ---
        const pulsaOnlyData = [
            { name: "Pulsa 5.000", price: 6500 }, 
            { name: "Pulsa 10.000", price: 11500 },
            { name: "Pulsa 25.000", price: 26500 },
            { name: "Pulsa 50.000", price: 51500 },
            { name: "Pulsa 100.000", price: 101500 },
            { name: "Pulsa 200.000", price: 201500 },
        ];

        const dataPackageData = [
            { name: "Data 10GB / 30 Hari", price: 55000 },
            { name: "Data 20GB / 30 Hari", price: 85000 },
            { name: "Data Unlimited", price: 120000 },
        ];

        function openService(serviceType) {
            selectedProduct = null;
            selectedPulsaMethod = null;
            selectedPulsaProvider = null;
            document.getElementById('btn-bayar-pulsa').disabled = true;
            document.getElementById('btn-bayar-pulsa').innerText = "Pilih Nominal & Metode";
            document.getElementById('pulsa-number').value = "";
            
            document.querySelectorAll('.sub-option').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.accordion-body').forEach(b => b.classList.remove('show'));
            document.querySelectorAll('.accordion-header').forEach(h => h.classList.remove('active'));

            if(serviceType === 'pulsa') {
                renderProductGrid('pulsa-grid', pulsaOnlyData, 'btn-bayar-pulsa');
                document.querySelector('#view-pulsa .page-title').innerText = 'Isi Pulsa';
                navigateTo('view-pulsa');
            } 
            else if (serviceType === 'data') {
                renderProductGrid('pulsa-grid', dataPackageData, 'btn-bayar-pulsa');
                document.querySelector('#view-pulsa .page-title').innerText = 'Paket Data';
                navigateTo('view-pulsa');
            } 
            else if (serviceType === 'pln') {
                renderProductGrid('pln-grid', [
                    {name: "Token 20.000", price: 22000},
                    {name: "Token 50.000", price: 52000},
                    {name: "Token 100.000", price: 102000}
                ], 'btn-beli-pln');
                navigateTo('view-pln');
            }
            else if (serviceType === 'game') {
                openGamesView();
            }
            else {
                document.getElementById('generic-title').innerText = serviceType.toUpperCase();
                navigateTo('view-generic');
            }
        }

        function renderProductGrid(elementId, data, btnId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'product-card';
                div.onclick = () => selectProduct(div, item.price, btnId);
                div.innerHTML = `
                    <span class="p-name">${item.name}</span>
                    <span class="p-price">Rp <span>${item.price.toLocaleString('id-ID')}</span></span>
                `;
                container.appendChild(div);
            });
        }

        function selectProduct(el, price, btnId) {
            const parent = el.parentElement;
            Array.from(parent.children).forEach(child => child.classList.remove('selected'));
            el.classList.add('selected');
            selectedProduct = price;
            
            if(btnId === 'btn-bayar-pulsa') {
                validatePulsaForm();
            } else {
                const btn = document.getElementById(btnId);
                btn.disabled = false;
                btn.innerText = "Bayar Rp " + formatRupiah(price);
            }
        }

        function selectPulsaMethod(category, provider, el) {
            const container = document.querySelector('#view-pulsa');
            container.querySelectorAll('.sub-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            
            selectedPulsaMethod = category;
            selectedPulsaProvider = provider;
            
            validatePulsaForm();
        }

        function validatePulsaForm() {
            const btn = document.getElementById('btn-bayar-pulsa');
            const phone = document.getElementById('pulsa-number').value;
            
            if (selectedProduct && phone.length > 9 && selectedPulsaProvider) {
                btn.disabled = false;
                btn.innerHTML = `Bayar <b>Rp ${formatRupiah(selectedProduct)}</b> via ${selectedPulsaProvider}`;
            } else {
                btn.disabled = true;
                btn.innerText = "Pilih Nominal & Metode";
            }
        }

        function processPulsaTransaction() {
            const btn = document.getElementById('btn-bayar-pulsa');
            const phone = document.getElementById('pulsa-number').value;
            
            if (selectedPulsaProvider === 'Saldo') {
                if (currentBalance < selectedProduct) {
                    showToast("Saldo akun tidak mencukupi!", "error");
                    return;
                }
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Memproses...';

            setTimeout(() => {
                if (selectedPulsaProvider === 'Saldo') {
                    updateBalance(selectedProduct, 'expense');
                }
                addHistory(`Pulsa ${phone} via ${selectedPulsaProvider}`, selectedProduct, 'expense');
                showToast("Transaksi Berhasil!", "success");

                setTimeout(() => {
                    goBack();
                }, 1000);
            }, 2000);
        }

        function checkProvider() {
            const val = document.getElementById('pulsa-number').value;
            const label = document.getElementById('provider-detected');
            if(val.length >= 4) {
                label.innerText = "Mendeteksi Provider...";
                setTimeout(() => {
                    if(val.startsWith('0812') || val.startsWith('0813')) label.innerText = "Telkomsel";
                    else if(val.startsWith('0818') || val.startsWith('0878')) label.innerText = "XL Axiata";
                    else if(val.startsWith('0857') || val.startsWith('0858')) label.innerText = "Indosat Ooredoo";
                    else label.innerText = "Provider Lain";
                }, 500);
            } else {
                label.innerText = "";
            }
        }

        document.getElementById('pln-id').addEventListener('keyup', function(e) {
            const val = this.value;
            const label = document.getElementById('pln-name');
            const btn = document.getElementById('btn-beli-pln');
            
            if(val.length >= 10) {
                label.innerText = "SUBSCRIBER ID: " + val;
                btn.disabled = !selectedProduct; 
            } else {
                label.innerText = "";
            }
        });

        function processTransaction(type) {
            const btn = event.target;
            const originalText = btn.innerText;
            
            if(!selectedProduct) return;

            if(currentBalance < selectedProduct) {
                showToast("Saldo tidak mencukupi!", "error");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Memproses...';

            setTimeout(() => {
                updateBalance(selectedProduct, 'expense');
                addHistory(type, selectedProduct, 'expense');
                
                showToast("Transaksi Berhasil!", "success");
                
                btn.innerText = "Berhasil!";
                btn.style.background = "var(--success)";
                
                setTimeout(() => {
                    goBack();
                    document.querySelectorAll('.input-field').forEach(i => i.value = "");
                    document.querySelectorAll('.product-grid').forEach(g => g.innerHTML = "");
                    selectedProduct = null;
                    btn.disabled = true;
                    btn.innerText = originalText;
                    btn.style.background = "var(--primary)";
                }, 1000);

            }, 1500);
        }

        // --- UTILITIES ---
        function updateBalance(amount, type) {
            if(type === 'expense') currentBalance -= amount;
            else currentBalance += amount;
            
            const el = document.getElementById('main-balance');
            el.innerText = "Rp " + currentBalance.toLocaleString('id-ID');
            
            el.style.color = type === 'income' ? 'var(--success)' : 'var(--danger)';
            setTimeout(() => el.style.color = 'white', 500);
        }

        function addHistory(title, amount, type) {
            const list = document.getElementById('transaction-list');
            const isIncome = type === 'income';
            const colorClass = isIncome ? 'income' : 'expense';
            const sign = isIncome ? '+' : '-';
            
            const html = `
                <div class="transaction-item" style="animation: slideDown 0.3s ease;">
                    <div class="trans-icon" style="color: ${isIncome ? 'var(--success)' : 'var(--primary)'};">
                        <i class="fa-solid ${isIncome ? 'fa-wallet' : 'fa-mobile-screen'}"></i>
                    </div>
                    <div class="trans-details">
                        <h4>${title}</h4>
                        <p>Baru Saja</p>
                    </div>
                    <div class="trans-amount ${colorClass}">${sign} Rp ${amount.toLocaleString('id-ID')}</div>
                </div>
            `;
            
            list.insertAdjacentHTML('afterbegin', html);
        }

        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID').format(angka);
        }

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-msg');
            const icon = toast.querySelector('i');
            
            toastMsg.innerText = msg;
            toast.className = `toast show ${type}`;
            
            if(type === 'success') icon.className = 'fa-solid fa-circle-check';
            else if(type === 'error') icon.className = 'fa-solid fa-circle-xmark';
            else icon.className = 'fa-solid fa-circle-info';

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

    </script>
</body>
</html>
